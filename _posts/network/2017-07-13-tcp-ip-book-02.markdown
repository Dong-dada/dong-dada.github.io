---
layout: post
title:  "《TCP/IP 详解》学习 02 链路层"
date:   2017-07-13 16:01:30 +0800
categories: network
---

* TOC
{:toc}


在 TCP/IP 协议族中，链路层主要有三个目的：
- 为 IP 模块发送和接收 IP 数据报；
- 为 ARP 模块发送 ARP 请求和接收 ARP 应答；
- 为 RARP 发送 RARP 请求和接收 RARP 应答；

TCP/IP 支持多种不同的链路层协议，所支持的协议取决于网络所使用的硬件，例如以太网、令牌环网、FDDI(光纤分布式数据接口)、RS-232串行线路等。

注意，这些协议都是在链路层上的，也就是利用某些硬件电缆将两台主机连接起来的协议，不要往上层去联想。


## 以太网和 IEEE 802 封装

以太网 (Ethernet) 这个术语一般是指 DEC, Intel, Xerox 公司在 1982 年联合公布的一个标准。它是当今 TCP/IP 采用的主要的局域网技术。它采用一种称作 CSMA/CD 的媒体介入方法。

几年后，IEEE 802 委员会公布了一个稍有不同的标准集，其中：
- 802.3 针对整个 CSMA/CD 网络；
- 802.4 针对令牌总线网络；
- 802.5 针对令牌环网络；

这三者的共同特性由 802.2 标准来定义。


## SLIP：串行线路 IP

SLIP 的全称是 Serial Line IP, 它是一种在串行线路上对 IP 数据报进行封装的简单形式。SLIP 适用于家庭中每台计算机几乎都有的 RS-232 串行端口和高速调制解调器介入 Internet。


## PPP：点对点协议

PPP 包括以下三个部分：
- 在串行线路上封装 IP 数据报的方法。PPP 即支持数据为 8 位和无奇偶校验的异步模式，还支持面向比特的同步链接；
- 建立、配置及测试数据链路的链路控制协议 (LCP, Link Control Protocol)。它允许通信双方进行协商，以确定不同的选项；
- 针对不同网络层协议的网络控制协议 (NCP, Network Control Protocol) 体系。当前 RFC 定义的网络层有 IP, OSI 网络层、DECnet 以及 AppleTalk。例如 IP NCP 允许双方协定是否对报文首部进行压缩，类似于 CSLIP


## 环回接口

大多数的产品都支持环回接口 (Loopback Interface)，以允许运行在同一台主机上的客户程序和服务器程序通过 TCP/IP 进行通信。

根据惯例，大多数系统把 IP 地址 127.0.0.1 分配给这个端口，并命名为 localhost。

可以想象，一旦传输层检测到目的端地址是环回地址时，应该可以省略部分传输层和所有网络层的逻辑操作。但是大多数产品还是照样完成传输层和网络层的所有过程，只是当 IP 数据报离开网络层时把它返回给自己。

下图是环回接口处理 IP 数据报的简单过程：

![]( {{site.url}}/asset/tcp-ip-book-loopback-interface.png )

上图中需要指出的几个关键点是：
- 传给环回地址 (127.0.0.1) 的任何数据都作为 IP 输入；
- 传给广播地址或多播地址的数据报会复制一份传给环回接口，然后送到以太网上。这是因为广播传送和多播传送的定义包含了主机本身；
- 任何传给该主机 IP 地址的数据都会被送到环回接口；

看上去用传输层和 IP 层的方法来处理环回数据似乎效率不高，但它简化了设计，因为环回接口可以被看做是网络层下面的另一个链路层。网络层把一份数据传送给环回接口，就像传给其它链路层一样，只不过环回接口把它返回到 IP 的输入队列中；


## 最大传输单元 MTU

以太网和 802.3 对数据帧的长度有一个限制，其最大值分别为 1500 和 1492 字节。链路层的这个特性被称为 MTU，最大传输单元。

如果 IP 层有一个数据报要传，而且数据的长度比链路层的 MTU 还要大，那么 IP 层就需要进行分片 (fragmentation)，把数据包分成若干个片，每一片都小于 MTU。


## 路径 MTU

当再同一个网络上的两台主机互相进行通信时，该网络的 MTU 是非常重要的。但是如果两台主机之间的通信要通过多个网络，那么每个网络的链路层就可能会有不同的 MTU。这时候就要选取这些 MTU 间最小的那一个，称为路径 MTU。

两台主机之间的路径 MTU 不一定是一个常数，这取决于当时所选择的路由。而选路不一定是对称的 (从 A 到 B 的路由可能与从 B 到 A 的路由不同)，因此路径 MTU 在两个方向上不一定是一致的。

